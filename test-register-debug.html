<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Registration Debug Test</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #000; color: #0f0; }
        .test { margin: 10px 0; padding: 10px; border: 1px solid #333; }
        .pass { border-color: #0f0; }
        .fail { border-color: #f00; color: #f00; }
        button { padding: 10px; margin: 5px; }
    </style>
</head>
<body>
    <h1>Registration Page Debug</h1>
    <div id="results"></div>

    <!-- Simulate the actual form structure -->
    <form id="registration-form" data-event-fee="500" style="margin-top: 30px; border: 1px solid #333; padding: 20px;">
        <h3>Test Form</h3>
        <input type="hidden" name="event_slug" value="devthon-2026">
        <input type="hidden" name="team_number" id="team-number">
        <input type="hidden" name="payment_amount" id="payment-amount">
        
        <div>
            <label>Team Size:</label>
            <button type="button" id="decrease-size">-</button>
            <input type="text" id="team-size-display" value="2" readonly style="width: 50px; text-align: center;">
            <button type="button" id="increase-size">+</button>
        </div>
        
        <div id="members-container" style="margin: 20px 0; padding: 10px; background: #111;"></div>
        
        <div>
            <span id="upi-id"></span> | <span id="upi-note"></span>
        </div>
        <div id="upi-mobile" style="display: none;">Mobile UPI</div>
        <div id="upi-desktop" style="display: none;">
            <img id="payment-qr" src="" style="width: 200px; height: 200px; background: #fff;">
        </div>
        <div id="total-amount">Total: ₹1000</div>
    </form>

    <script type="module">
        const log = (msg, pass = true) => {
            const div = document.createElement('div');
            div.className = 'test ' + (pass ? 'pass' : 'fail');
            div.textContent = (pass ? '✓ ' : '✗ ') + msg;
            document.getElementById('results').appendChild(div);
        };

        // Test 1: Check if script loads
        log('Script loaded and executing');

        // Test 2: Check if DOM elements exist
        const elements = [
            'registration-form',
            'team-size-display', 
            'increase-size',
            'decrease-size',
            'members-container',
            'payment-qr',
            'team-number',
            'payment-amount',
            'upi-id',
            'upi-note'
        ];

        let allFound = true;
        elements.forEach(id => {
            const el = document.getElementById(id);
            if (!el) {
                log(`Missing element: ${id}`, false);
                allFound = false;
            }
        });
        if (allFound) log('All DOM elements found');

        // Test 3: Try to load Supabase module
        try {
            const module = await import('https://www.devupvjit.in/_astro/supabase.BajSTEY1.js');
            log('Supabase module loaded: ' + typeof module.s);
            
            // Test 4: Try to query Supabase
            try {
                const { data, error } = await module.s
                    .from('registrations')
                    .select('id')
                    .limit(1);
                
                if (error) {
                    log('Supabase query error: ' + error.message, false);
                } else {
                    log('Supabase query works! Got ' + (data?.length || 0) + ' records');
                }
            } catch (err) {
                log('Supabase query exception: ' + err.message, false);
            }
        } catch (err) {
            log('Failed to load Supabase module: ' + err.message, false);
        }

        // Test 5: Load the actual hoisted script
        try {
            log('Attempting to load production hoisted script...');
            await import('https://www.devupvjit.in/_astro/hoisted.B9JiXYQ3.js');
            log('Hoisted script loaded');
            
            // Wait a bit for initialization
            setTimeout(() => {
                const increaseBtn = document.getElementById('increase-size');
                if (increaseBtn && increaseBtn.onclick) {
                    log('Button handlers attached');
                } else {
                    log('Button handlers NOT attached', false);
                }
            }, 1000);
        } catch (err) {
            log('Failed to load hoisted script: ' + err.message, false);
        }
    </script>
</body>
</html>
